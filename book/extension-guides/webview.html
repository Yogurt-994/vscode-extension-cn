<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Webview - VS Code æ’ä»¶å¼€å‘æ–‡æ¡£</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">é¢„å¤‡çŸ¥è¯†</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../preknowledge/first-step.html"><strong aria-hidden="true">1.</strong> éJSå¼€å‘è€…çš„ç¬¬ä¸€æ­¥</a></li><li class="chapter-item expanded "><a href="../preknowledge/variable-and-type.html"><strong aria-hidden="true">2.</strong> Typescript-å˜é‡å’Œç±»å‹</a></li><li class="chapter-item expanded "><a href="../preknowledge/class.html"><strong aria-hidden="true">3.</strong> Typescript-ç±»</a></li><li class="chapter-item expanded "><a href="../preknowledge/interface-and-namespace.html"><strong aria-hidden="true">4.</strong> Typescript-æ¥å£å’Œå‘½åç©ºé—´</a></li><li class="chapter-item expanded "><a href="../preknowledge/generics.html"><strong aria-hidden="true">5.</strong> Typescript-æ³›å‹</a></li><li class="chapter-item expanded "><a href="../preknowledge/declaration-files.html"><strong aria-hidden="true">6.</strong> Typescript-å£°æ˜æ–‡ä»¶</a></li><li class="chapter-item expanded affix "><li class="part-title">ç¬¬ä¸€æ­¥</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../get-started/your-first-extension.html"><strong aria-hidden="true">7.</strong> ä½ çš„ç¬¬ä¸€ä¸ªæ’ä»¶</a></li><li class="chapter-item expanded "><a href="../get-started/extension-anatomy.html"><strong aria-hidden="true">8.</strong> è§£ææ’ä»¶ç»“æ„</a></li><li class="chapter-item expanded "><a href="../get-started/wrapping-up.html"><strong aria-hidden="true">9.</strong> å°ç»“</a></li><li class="chapter-item expanded affix "><li class="part-title">å¼€å‘æ’ä»¶</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../working-with-extensions/testing-extension.html"><strong aria-hidden="true">10.</strong> æµ‹è¯•æ’ä»¶</a></li><li class="chapter-item expanded "><a href="../working-with-extensions/publish-extension.html"><strong aria-hidden="true">11.</strong> å‘å¸ƒæ’ä»¶</a></li><li class="chapter-item expanded "><a href="../working-with-extensions/bundling-extension.html"><strong aria-hidden="true">12.</strong> æ‰“åŒ…æ’ä»¶</a></li><li class="chapter-item expanded "><a href="../working-with-extensions/continuous-integration.html"><strong aria-hidden="true">13.</strong> æŒé›†æˆ</a></li><li class="chapter-item expanded affix "><li class="part-title">æ’ä»¶åŠŸèƒ½</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../extension-capabilities/index.html"><strong aria-hidden="true">14.</strong> æ¦‚è¿°</a></li><li class="chapter-item expanded "><a href="../extension-capabilities/common-capabilities.html"><strong aria-hidden="true">15.</strong> å¸¸ç”¨åŠŸèƒ½</a></li><li class="chapter-item expanded "><a href="../extension-capabilities/theming.html"><strong aria-hidden="true">16.</strong> ä¸»é¢˜</a></li><li class="chapter-item expanded "><a href="../extension-capabilities/extending-workbench.html"><strong aria-hidden="true">17.</strong> æ‰©å±•å·¥ä½œå°</a></li><li class="chapter-item expanded affix "><li class="part-title">æ’ä»¶æŒ‡å—</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../extension-guides/index.html"><strong aria-hidden="true">18.</strong> æ¦‚è¿°</a></li><li class="chapter-item expanded "><a href="../extension-guides/command.html"><strong aria-hidden="true">19.</strong> å‘½ä»¤</a></li><li class="chapter-item expanded "><a href="../extension-guides/color-theme.html"><strong aria-hidden="true">20.</strong> è‰²å½©ä¸»é¢˜</a></li><li class="chapter-item expanded "><a href="../extension-guides/file-icon-theme.html"><strong aria-hidden="true">21.</strong> æ–‡ä»¶å›¾æ ‡ä¸»é¢˜</a></li><li class="chapter-item expanded "><a href="../extension-guides/product-icon-theme.html"><strong aria-hidden="true">22.</strong> äº§å“å›¾æ ‡ä¸»é¢˜</a></li><li class="chapter-item expanded "><a href="../extension-guides/tree-view.html"><strong aria-hidden="true">23.</strong> æ ‘è§†å›¾</a></li><li class="chapter-item expanded "><a href="../extension-guides/webview.html" class="active"><strong aria-hidden="true">24.</strong> Webview</a></li><li class="chapter-item expanded "><a href="../extension-guides/notebook.html"><strong aria-hidden="true">25.</strong> ç¬”è®°æœ¬</a></li><li class="chapter-item expanded "><a href="../extension-guides/virtual-documents.html"><strong aria-hidden="true">26.</strong> è™šæ‹Ÿæ–‡æ¡£</a></li><li class="chapter-item expanded "><a href="../extension-guides/task-provider.html"><strong aria-hidden="true">27.</strong> ä»»åŠ¡</a></li><li class="chapter-item expanded "><a href="../extension-guides/scm-provider.html"><strong aria-hidden="true">28.</strong> æºæ§åˆ¶</a></li><li class="chapter-item expanded "><a href="../extension-guides/debugger-extension.html"><strong aria-hidden="true">29.</strong> è°ƒè¯•å™¨æ’ä»¶</a></li><li class="chapter-item expanded "><a href="../extension-guides/markdown-extension.html"><strong aria-hidden="true">30.</strong> Markdownæ’ä»¶</a></li><li class="chapter-item expanded "><a href="../extension-guides/custom-editors.html"><strong aria-hidden="true">31.</strong> è‡ªå®šä¹‰ç¼–è¾‘å™¨</a></li><li class="chapter-item expanded "><a href="../extension-guides/custom-data-extension.html"><strong aria-hidden="true">32.</strong> è‡ªå®šä¹‰æ•°æ®æ’ä»¶</a></li><li class="chapter-item expanded affix "><li class="part-title">è¯­è¨€æ’ä»¶</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../language-extensions/index.html"><strong aria-hidden="true">33.</strong> æ¦‚è¿°</a></li><li class="chapter-item expanded "><a href="../language-extensions/syntax-highlight-guide.html"><strong aria-hidden="true">34.</strong> è¯­æ³•é«˜äº®</a></li><li class="chapter-item expanded "><a href="../language-extensions/semantic-highlight-guide.html"><strong aria-hidden="true">35.</strong> è¯­ä¹‰é«˜äº®</a></li><li class="chapter-item expanded "><a href="../language-extensions/snippet-guide.html"><strong aria-hidden="true">36.</strong> ä»£ç ç‰‡æ®µ</a></li><li class="chapter-item expanded "><a href="../language-extensions/language-configuration-guide.html"><strong aria-hidden="true">37.</strong> è¯­è¨€é…ç½®</a></li><li class="chapter-item expanded "><a href="../language-extensions/programmatic-language-features.html"><strong aria-hidden="true">38.</strong> ç¨‹åºæ€§è¯­è¨€ç‰¹æ€§</a></li><li class="chapter-item expanded "><a href="../language-extensions/language-server-extension-guide.html"><strong aria-hidden="true">39.</strong> è¯­è¨€æœåŠ¡å™¨</a></li><li class="chapter-item expanded "><a href="../language-extensions/embedded-languages.html"><strong aria-hidden="true">40.</strong> åµŒå…¥è¯­è¨€</a></li><li class="chapter-item expanded affix "><li class="part-title">è¿›é˜¶ä¸»é¢˜</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../advanced-topics/extension-host.html"><strong aria-hidden="true">41.</strong> æ’ä»¶ä¸»æœº</a></li><li class="chapter-item expanded "><a href="../advanced-topics/remote-extensions.html"><strong aria-hidden="true">42.</strong> è¿œç¨‹å¼€å‘</a></li><li class="chapter-item expanded "><a href="../advanced-topics/using-proposed-api.html"><strong aria-hidden="true">43.</strong> ä½¿ç”¨ä¸ç¨³å®šçš„API</a></li><li class="chapter-item expanded affix "><li class="part-title">ï¸ï¸å‚è€ƒ</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../references/vscode-api.html"><strong aria-hidden="true">44.</strong> VS Code API</a></li><li class="chapter-item expanded "><a href="../references/contribution-points.html"><strong aria-hidden="true">45.</strong> å‘å¸ƒå†…å®¹é…ç½®</a></li><li class="chapter-item expanded "><a href="../references/activation-events.html"><strong aria-hidden="true">46.</strong> æ¿€æ´»äº‹ä»¶</a></li><li class="chapter-item expanded "><a href="../references/extension-manifest.html"><strong aria-hidden="true">47.</strong> æ’ä»¶æ¸…å•</a></li><li class="chapter-item expanded "><a href="../references/commands.html"><strong aria-hidden="true">48.</strong> å‘½ä»¤</a></li><li class="chapter-item expanded "><a href="../references/when-clause-contexts.html"><strong aria-hidden="true">49.</strong> when å­å¥ä¸Šä¸‹æ–‡</a></li><li class="chapter-item expanded "><a href="../references/theme-color.html"><strong aria-hidden="true">50.</strong> ä¸»é¢˜è‰²å½©</a></li><li class="chapter-item expanded "><a href="../references/icons-in-labels.html"><strong aria-hidden="true">51.</strong> æ ‡ç­¾ä¸­çš„å›¾æ ‡</a></li><li class="chapter-item expanded "><a href="../references/document-selector.html"><strong aria-hidden="true">52.</strong> æ–‡æ¡£é€‰æ‹©å™¨</a></li><li class="chapter-item expanded "><a href="../references/extension-guidelines.html"><strong aria-hidden="true">53.</strong> æ’ä»¶å¼€å‘å‡†åˆ™</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">VS Code æ’ä»¶å¼€å‘æ–‡æ¡£</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="webview-api"><a class="header" href="#webview-api">Webview API</a></h1>
<p>webview APIä¸ºå¼€å‘è€…æä¾›äº†å®Œå…¨è‡ªå®šä¹‰è§†å›¾çš„èƒ½åŠ›ï¼Œä¾‹å¦‚å†…ç½®çš„Markdownæ’ä»¶ä½¿ç”¨äº†webviewæ¸²æŸ“Markdowné¢„è§ˆæ–‡ä»¶ã€‚Webviewä¹Ÿèƒ½ç”¨äºæ„å»ºæ¯”VS CodeåŸç”ŸAPIæ”¯æŒæ„å»ºçš„æ›´åŠ å¤æ‚çš„ç”¨æˆ·äº¤äº’ç•Œé¢ã€‚</p>
<p>å¯ä»¥æŠŠwebviewçœ‹æˆæ˜¯VS Codeä¸­çš„<code>iframe</code>ï¼Œå®ƒå¯ä»¥æ¸²æŸ“å‡ ä¹å…¨éƒ¨çš„HTMLå†…å®¹ï¼Œå®ƒé€šè¿‡æ¶ˆæ¯æœºåˆ¶å’Œæ’ä»¶é€šä¿¡ã€‚è¿™æ ·çš„è‡ªç”±åº¦ä»¤æˆ‘ä»¬çš„webviewéå¸¸å¼ºåŠ²å¹¶å°†æ’ä»¶çš„æ½œåŠ›æå‡åˆ°äº†æ–°çš„é«˜åº¦ã€‚</p>
<h2 id="ç›¸å…³é“¾æ¥"><a class="header" href="#ç›¸å…³é“¾æ¥">ç›¸å…³é“¾æ¥</a></h2>
<hr />
<ul>
<li><a href="https://github.com/Microsoft/vscode-extension-samples/blob/master/webview-sample/README.md">Webview ç¤ºä¾‹</a></li>
</ul>
<h3 id="ä½¿ç”¨çš„vs-code-api"><a class="header" href="#ä½¿ç”¨çš„vs-code-api">ä½¿ç”¨çš„VS Code API</a></h3>
<ul>
<li><a href="https://code.visualstudio.com/api/references/vscode-api#window.createWebviewPanel">window.createWebviewPanel</a></li>
<li><a href="https://code.visualstudio.com/api/references/vscode-api#window.registerWebviewPanelSerializer">window.registerWebviewPanelSerializer</a></li>
</ul>
<h2 id="æˆ‘åº”è¯¥ç”¨webviewå—"><a class="header" href="#æˆ‘åº”è¯¥ç”¨webviewå—">æˆ‘åº”è¯¥ç”¨webviewå—ï¼Ÿ</a></h2>
<hr />
<p>webviewè™½ç„¶å¾ˆèµï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥èŠ‚åˆ¶åœ°ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½â€”â€”æ¯”å¦‚å½“VS CodeåŸç”ŸAPIä¸å¤Ÿç”¨æ—¶ã€‚Webviewé‡åº¦ä¾èµ–èµ„æºï¼Œæ‰€ä»¥å®ƒè„±ç¦»æ’ä»¶çš„è¿›ç¨‹è€Œå•ç‹¬è¿è¡Œåœ¨å…¶ä»–ç¯å¢ƒä¸­ã€‚åœ¨VS Codeä¸­ä½¿ç”¨è®¾è®¡ä¸è‰¯çš„webviewä¼šè®©ç”¨æˆ·æŠ“ç‹‚ã€‚</p>
<p>åœ¨ä½¿ç”¨webviewä¹‹å‰ï¼Œè¯·ä½œä»¥ä¸‹è€ƒè™‘ï¼š</p>
<ul>
<li>è¿™ä¸ªåŠŸèƒ½çœŸçš„éœ€è¦VS Codeæ¥æä¾›å—ï¼Ÿåˆ†ç¦»æˆä¸€ä¸ªåº”ç”¨æˆ–è€…ç½‘ç«™ä¼šä¸ä¼šæ›´å¥½ï¼Ÿ</li>
<li>webviewæ˜¯å®ç°è¿™ä¸ªç‰¹æ€§çš„æœ€åæ–¹æ¡ˆå—ï¼ŸVS CodeåŸç”ŸAPIæ˜¯å¦èƒ½è¾¾åˆ°åŒæ ·çš„ç›®çš„å‘¢ï¼Ÿ</li>
<li>ä½ çš„webviewæ‰€ç‰ºç‰²çš„é«˜èµ„æºå ç”¨æ˜¯å¦èƒ½æ¢å¾—åŒæ ·çš„ç”¨æˆ·ä»·å€¼ï¼Ÿ</li>
</ul>
<p>è¯·è®°ä½ï¼šä¸è¦å› ä¸ºèƒ½ä½¿ç”¨webviewè€Œæ»¥ç”¨webviewã€‚ç›¸åï¼Œå¦‚æœä½ æœ‰å……è¶³çš„ç†ç”±å’Œè‡ªä¿¡ï¼Œé‚£ä¹ˆæœ¬ç¯‡æ•™ç¨‹å¯¹ä½ æ¥è¯´ä¼šéå¸¸æœ‰ç”¨ï¼Œç°åœ¨å°±è®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p>
<h2 id="webviews-api-åŸºç¡€"><a class="header" href="#webviews-api-åŸºç¡€">Webviews API åŸºç¡€</a></h2>
<hr />
<p>ä¸ºäº†è§£é‡ŠwebviewAPIï¼Œæˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªç®€å•çš„<strong>Cat Coding</strong>æ’ä»¶ã€‚è¿™ä¸ªæ’ä»¶ä¼šç”¨ä¸€ä¸ªwebviewæ˜¾ç¤ºçŒ«å†™ä»£ç çš„gifã€‚éšç€æˆ‘ä»¬ä¸æ–­äº†è§£APIï¼Œæˆ‘ä»¬ä¼šä¸æ–­åœ°ç»™æ’ä»¶æ·»åŠ åŠŸèƒ½ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„çŒ«å†™äº†å¤šå°‘è¡Œä»£ç çš„è®¡æ•°è·Ÿè¸ªå™¨ï¼Œå¦‚æœçŒ«çŒ«å†™å‡ºäº†bugè¿˜ä¼šæœ‰ä¸€ä¸ªæç¤ºå¼¹å‡ºæ¡†ã€‚</p>
<p>è¿™æ˜¯<strong>Cat Coding</strong>æ’ä»¶çš„ç¬¬ä¸€ç‰ˆ<code>package.json</code>ï¼Œä½ å¯ä»¥åœ¨<a href="https://github.com/Microsoft/vscode-extension-samples/blob/master/webview-sample/README.md">è¿™é‡Œ</a>æ‰¾åˆ°å®Œæ•´çš„ä»£ç ã€‚æˆ‘ä»¬çš„ç¬¬ä¸€ç‰ˆæ’ä»¶<a href="/extensibility-reference/contribution-points#contributescommands">æä¾›äº†ä¸€ä¸ªå‘½ä»¤</a>ï¼Œå«åš<code>catCoding.start</code>ã€‚å½“ç”¨æˆ·ä»<strong>å‘½ä»¤é¢æ¿</strong>è°ƒç”¨<em>Cat Coding: Start new cat coding session</em>ï¼Œæˆ–è€…ä¸€ä¸ªåˆ›å»ºå¥½çš„<em>é”®ç»‘å®š</em>å‘½ä»¤ï¼Œæˆ‘ä»¬çš„çŒ«çŒ«ä¼šå‡ºç°åœ¨webviewçª—å£å†…ã€‚</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;cat-coding&quot;,
  &quot;description&quot;: &quot;Cat Coding&quot;,
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;publisher&quot;: &quot;bierner&quot;,
  &quot;engines&quot;: {
    &quot;vscode&quot;: &quot;^1.23.0&quot;
  },
  &quot;activationEvents&quot;: [&quot;onCommand:catCoding.start&quot;],
  &quot;main&quot;: &quot;./out/src/extension&quot;,
  &quot;contributes&quot;: {
    &quot;commands&quot;: [
      {
        &quot;command&quot;: &quot;catCoding.start&quot;,
        &quot;title&quot;: &quot;Start new cat coding session&quot;,
        &quot;category&quot;: &quot;Cat Coding&quot;
      }
    ]
  },
  &quot;scripts&quot;: {
    &quot;vscode:prepublish&quot;: &quot;tsc -p ./&quot;,
    &quot;compile&quot;: &quot;tsc -watch -p ./&quot;,
    &quot;postinstall&quot;: &quot;node ./node_modules/vscode/bin/install&quot;
  },
  &quot;dependencies&quot;: {
    &quot;vscode&quot;: &quot;*&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@types/node&quot;: &quot;^9.4.6&quot;,
    &quot;typescript&quot;: &quot;^2.8.3&quot;
  }
}
</code></pre>
<p>ç°åœ¨è®©æˆ‘ä»¬å®ç°<code>catCoding.start</code>å‘½ä»¤ï¼Œåœ¨æˆ‘ä»¬çš„ä¸»æ–‡ä»¶ä¸­ï¼Œåƒä¸‹é¢è¿™æ ·æ³¨å†Œä¸€ä¸ªåŸºç¡€çš„webviewï¼š</p>
<pre><code class="language-typescript">import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      // åˆ›å»ºå¹¶æ˜¾ç¤ºæ–°çš„webview
      const panel = vscode.window.createWebviewPanel(
        'catCoding', // åªä¾›å†…éƒ¨ä½¿ç”¨ï¼Œè¿™ä¸ªwebviewçš„æ ‡è¯†
        'Cat Coding', // ç»™ç”¨æˆ·æ˜¾ç¤ºçš„é¢æ¿æ ‡é¢˜
        vscode.ViewColumn.One, // ç»™æ–°çš„webviewé¢æ¿ä¸€ä¸ªç¼–è¾‘å™¨è§†å›¾
        {} // Webviewé€‰é¡¹ã€‚æˆ‘ä»¬ç¨åä¼šç”¨ä¸Š
      );
    })
  );
}
</code></pre>
<p><code>vscode.window.createWebviewPanel</code>å‡½æ•°åˆ›å»ºå¹¶åœ¨ç¼–è¾‘åŒºå±•ç¤ºäº†ä¸€ä¸ªwebviewï¼Œä¸‹å›¾æ˜¾ç¤ºäº†å¦‚æœä½ è¯•ç€è¿è¡Œ<code>catCoding.start</code>å‘½ä»¤ä¼šæ˜¾ç¤ºçš„ä¸œè¥¿ï¼š</p>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-no_content.png" alt="ä¸€ä¸ªç©ºçš„webview" /></p>
<p>æˆ‘ä»¬çš„å‘½ä»¤ä»¥æ­£ç¡®çš„æ ‡é¢˜æ‰“å¼€äº†ä¸€ä¸ªæ–°çš„webviewé¢æ¿ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å†…å®¹ï¼è¦æƒ³æŠŠæˆ‘ä»¬çš„çŒ«åŠ åˆ°è¿™ä¸ªé¢æ¿é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦<code>webview.html</code>è®¾ç½®HTMLå†…å®¹ã€‚</p>
<pre><code class="language-typescript">import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      // åˆ›å»ºå’Œæ˜¾ç¤ºwebview
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      // è®¾ç½®HTMLå†…å®¹
      panel.webview.html = getWebviewContent();
    })
  );
}

function getWebviewContent() {
  return
    `
        &lt;!DOCTYPE html&gt;
        &lt;html lang=&quot;en&quot;&gt;
        &lt;head&gt;
            &lt;meta charset=&quot;UTF-8&quot;&gt;
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
            &lt;title&gt;Cat Coding&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;img src=&quot;https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif&quot; width=&quot;300&quot; /&gt;
        &lt;/body&gt;
        &lt;/html&gt;
    `;
}
</code></pre>
<p>å¦‚æœä½ å†æ¬¡è¿è¡Œå‘½ä»¤ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ä¸‹å›¾ï¼š</p>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-html.png" alt="å«æœ‰htmlå†…å®¹çš„webview" /></p>
<p>å¤§åŠŸå‘Šæˆï¼</p>
<p><code>webview.html</code>åº”è¯¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„HTMLæ–‡æ¡£ã€‚ä½¿ç”¨HTMLç‰‡æ®µæˆ–è€…æ ¼å¼é”™ä¹±çš„HTMLä¼šé€ æˆå¼‚å¸¸ã€‚</p>
<h3 id="æ›´æ–°webviewå†…å®¹"><a class="header" href="#æ›´æ–°webviewå†…å®¹">æ›´æ–°webviewå†…å®¹</a></h3>
<p><code>webview.html</code>ä¹Ÿèƒ½åœ¨webviewåˆ›å»ºåæ›´æ–°å†…å®¹ï¼Œè®©æˆ‘ä»¬ç”¨çŒ«çŒ«è½®æ’­å›¾ä½¿<strong>Cat Coding</strong>å…·æœ‰åŠ¨æ€æ€§ï¼š</p>
<pre><code class="language-typescript">import * as vscode from 'vscode';

const cats = {
  'Coding Cat': 'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif',
  'Compiling Cat': 'https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif'
};

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      let iteration = 0;
      const updateWebview = () =&gt; {
        const cat = iteration++ % 2 ? 'Compiling Cat' : 'Coding Cat';
        panel.title = cat;
        panel.webview.html = getWebviewContent(cat);
      };

      // è®¾ç½®åˆå§‹åŒ–å†…å®¹
      updateWebview();

      // æ¯ç§’æ›´æ–°å†…å®¹
      setInterval(updateWebview, 1000);
    })
  );
}

function getWebviewContent(cat: keyof typeof cats) {
  return
    `
        &lt;!DOCTYPE html&gt;
        &lt;html lang=&quot;en&quot;&gt;
        &lt;head&gt;
            &lt;meta charset=&quot;UTF-8&quot;&gt;
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
            &lt;title&gt;Cat Coding&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;img src=&quot;${cats[cat]}&quot; width=&quot;300&quot; /&gt;
        &lt;/body&gt;
        &lt;/html&gt;
    `;
}
</code></pre>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-update.gif" alt="æ›´æ–°webviewå†…å®¹" /></p>
<p>å› ä¸º<code>webview.html</code>æ–¹æ³•æ›¿æ¢äº†æ•´ä¸ªwebviewå†…å®¹ï¼Œé¡µé¢çœ‹èµ·æ¥åƒé‡æ–°åŠ è½½äº†ä¸€ä¸ªiframeã€‚è®°ä½ï¼šå¦‚æœä½ åœ¨webviewä¸­ä½¿ç”¨äº†è„šæœ¬ï¼Œé‚£å°±æ„å‘³ç€<code>webview.html</code>çš„é‡ç½®ä¼šä½¿è„šæœ¬çŠ¶æ€é‡ç½®ã€‚</p>
<p>ä¸Šè¿°ç¤ºä¾‹ä¹Ÿä½¿ç”¨äº†<code>webview.title</code>æ”¹å˜ç¼–è¾‘å™¨ä¸­çš„å±•ç¤ºçš„æ–‡ä»¶åç§°ï¼Œè®¾ç½®æ ‡é¢˜ä¸ä¼šä½¿webviewé‡è½½ã€‚</p>
<h3 id="ç”Ÿå‘½å‘¨æœŸ"><a class="header" href="#ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ</a></h3>
<p>webviewä»å±äºåˆ›å»ºä»–ä»¬çš„æ’ä»¶ï¼Œæ’ä»¶å¿…é¡»ä¿æŒä½ä»webviewè¿”å›çš„<code>createWebviewPanel</code>ã€‚å¦‚æœä½ çš„æ’ä»¶å¤±å»äº†è¿™ä¸ªå…³è”ï¼Œå®ƒå°±ä¸èƒ½å†è®¿é—®webviewäº†ï¼Œä¸è¿‡å³ä½¿è¿™æ ·ï¼Œwebviewè¿˜ä¼šç»§ç»­å±•ç¤ºåœ¨VS Codeä¸­ã€‚</p>
<p>å› ä¸ºwebviewæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨è§†å›¾ï¼Œæ‰€ä»¥ç”¨æˆ·å¯ä»¥éšæ—¶å…³é—­webviewã€‚å½“ç”¨æˆ·å…³é—­äº†webviewé¢æ¿åï¼Œwebviewå°±è¢«é”€æ¯äº†ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œé”€æ¯webviewæ—¶æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œè¯´æ˜æˆ‘ä»¬ä¸Šé¢çš„ç¤ºä¾‹ä¸­ä½¿ç”¨çš„<code>seInterval</code>å®é™…ä¸Šäº§ç”Ÿäº†éå¸¸ä¸¥é‡çš„Bugï¼šå¦‚æœç”¨æˆ·å…³é—­äº†é¢æ¿ï¼Œ<code>setInterval</code>ä¼šç»§ç»­è§¦å‘ï¼Œè€Œä¸”è¿˜ä¼šå°è¯•æ›´æ–°<code>panel.webview.html</code>ï¼Œè¿™å½“ç„¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å–µæ˜Ÿäººå¯ä¸å–œæ¬¢å¼‚å¸¸ï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥è§£å†³è¿™ä¸ªé—®é¢˜å§ã€‚</p>
<p><code>onDidDispose</code>äº‹ä»¶åœ¨webviewè¢«é”€æ¯æ—¶è§¦å‘ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªäº‹ä»¶ç»“æŸä¹‹åæ›´æ–°å¹¶é‡Šæ”¾webviewèµ„æºã€‚</p>
<pre><code class="language-typescript">import * as vscode from 'vscode';

const cats = {
  'Coding Cat': 'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif',
  'Compiling Cat': 'https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif'
};

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      let iteration = 0;
      const updateWebview = () =&gt; {
        const cat = iteration++ % 2 ? 'Compiling Cat' : 'Coding Cat';
        panel.title = cat;
        panel.webview.html = getWebviewContent(cat);
      };

      updateWebview();
      const interval = setInterval(updateWebview, 1000);

      panel.onDidDispose(
        () =&gt; {
          // å½“é¢æ¿å…³é—­æ—¶ï¼Œå–æ¶ˆwebviewå†…å®¹ä¹‹åçš„æ›´æ–°
          clearInterval(interval);
        },
        null,
        context.subscriptions
      );
    })
  );
}
</code></pre>
<p>æ’ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼å…³é—­webviewè§†å›¾â€”â€”è°ƒç”¨å®ƒä»¬çš„<code>dispose()</code>æ–¹æ³•ã€‚æˆ‘ä»¬å‡è®¾ï¼Œç°åœ¨é™åˆ¶æˆ‘ä»¬çš„çŒ«çŒ«æ¯å¤©å·¥ä½œ5ç§’é’Ÿï¼š</p>
<pre><code class="language-typescript">export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      panel.webview.html = getWebviewContent(cats['Coding Cat']);

      // 5ç§’åï¼Œç¨‹åºæ€§åœ°å…³é—­webviewé¢æ¿
      const timeout = setTimeout(() =&gt; panel.dispose(), 5000);

      panel.onDidDispose(
        () =&gt; {
          // åœ¨ç¬¬äº”ç§’ç»“æŸä¹‹å‰å¤„ç†ç”¨æˆ·æ‰‹åŠ¨çš„å…³é—­åŠ¨ä½œ
          clearTimeout(timeout);
        },
        null,
        context.subscriptions
      );
    })
  );
}
</code></pre>
<h3 id="ç§»åŠ¨å’Œå¯è§æ€§"><a class="header" href="#ç§»åŠ¨å’Œå¯è§æ€§">ç§»åŠ¨å’Œå¯è§æ€§</a></h3>
<p>å½“webviewé¢æ¿è¢«ç§»åŠ¨åˆ°äº†éæ¿€æ´»æ ‡ç­¾ä¸Šï¼Œå®ƒå°±éšè—èµ·æ¥äº†ã€‚ä½†è¿™æ—¶å¹¶ä¸æ˜¯é”€æ¯ï¼Œå½“é‡æ–°æ¿€æ´»æ ‡ç­¾åï¼ŒVS Codeä¼šä»<code>webview.html</code>è‡ªåŠ¨æ¢å¤webviewçš„å†…å®¹ã€‚</p>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-restore.gif" alt="webviewè‡ªåŠ¨æ¢å¤å†…å®¹" /></p>
<p><code>.visible</code>å±æ€§å‘Šè¯‰ä½ å½“å‰webviewé¢æ¿æ˜¯å¦æ˜¯å¯è§çš„ã€‚</p>
<p>æ’ä»¶ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨<code>reveal()</code>æ–¹æ³•ï¼Œç¨‹åºæ€§åœ°å°†webviewé¢æ¿æ¿€æ´»ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªç”¨äºæ”¾ç½®é¢æ¿çš„ç›®æ ‡è§†å›¾å¸ƒå±€ã€‚ä¸€ä¸ªé¢æ¿ä¸€æ¬¡åªèƒ½æ˜¾ç¤ºåœ¨ä¸€ä¸ªç¼–è¾‘å¸ƒå±€ä¸­ã€‚è°ƒç”¨<code>reveal()</code>æˆ–è€…æ‹–åŠ¨webviewé¢æ¿åˆ°æ–°çš„ç¼–è¾‘å¸ƒå±€ä¸­å»ã€‚</p>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-drag.gif" alt="åœ¨æ ‡ç­¾é¡µä¸­ç§»åŠ¨webviewè§†å›¾" /></p>
<p>ç°åœ¨æ›´æ–°æˆ‘ä»¬çš„æ’ä»¶ï¼Œä¸€æ¬¡åªå…è®¸å­˜åœ¨ä¸€ä¸ªwebviewè§†å›¾ã€‚å¦‚æœé¢æ¿å¤„äºéæ¿€æ´»çŠ¶æ€ï¼Œé‚£<code>catCoding.start</code>å‘½ä»¤å°±æŠŠè¿™ä¸ªé¢æ¿æ¿€æ´»ã€‚</p>
<pre><code class="language-typescript">export function activate(context: vscode.ExtensionContext) {
  // è¿½è¸ªå½“å‰webviewé¢æ¿
  let currentPanel: vscode.WebviewPanel | undefined = undefined;

  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const columnToShowIn = vscode.window.activeTextEditor
        ? vscode.window.activeTextEditor.viewColumn
        : undefined;

      if (currentPanel) {
        // å¦‚æœæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªé¢æ¿ï¼Œé‚£å°±æŠŠå®ƒæ˜¾ç¤ºåˆ°ç›®æ ‡åˆ—å¸ƒå±€ä¸­
        currentPanel.reveal(columnToShowIn);
      } else {
        // ä¸ç„¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°é¢æ¿
        currentPanel = vscode.window.createWebviewPanel(
          'catCoding',
          'Cat Coding',
          columnToShowIn,
          {}
        );
        currentPanel.webview.html = getWebviewContent(cats['Coding Cat']);

        // å½“å‰é¢æ¿è¢«å…³é—­åé‡ç½®
        currentPanel.onDidDispose(
          () =&gt; {
            currentPanel = undefined;
          },
          null,
          context.subscriptions
        );
      }
    })
  );
}
</code></pre>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ–°æ’ä»¶çš„è¡Œä¸ºï¼š</p>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-single_panel.gif" alt="åœ¨å•ä¸ªé¢æ¿ä¸­å±•ç¤º" /></p>
<p>ä¸è®ºä½•æ—¶ï¼Œå¦‚æœwebviewçš„å¯è§æ€§æ”¹å˜äº†ï¼Œæˆ–è€…å½“webviewç§»åŠ¨åˆ°äº†æ–°çš„è§†å›¾å¸ƒå±€ä¸­ï¼Œå°±ä¼šè§¦å‘<code>onDidChangeViewState</code>ã€‚æˆ‘ä»¬çš„æ’ä»¶å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ—¶é—´æ”¹å˜å¸ƒå±€ä¸­çš„webviewæ˜¾ç¤ºçš„çŒ«ï¼š</p>
<pre><code class="language-typescript">const cats = {
  'Coding Cat': 'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif',
  'Compiling Cat': 'https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif',
  'Testing Cat': 'https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif'
};

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );
      panel.webview.html = getWebviewContent(cats['Coding Cat']);

      // æ ¹æ®è§†å›¾çŠ¶æ€å˜åŠ¨æ›´æ–°å†…å®¹
      panel.onDidChangeViewState(
        e =&gt; {
          const panel = e.webviewPanel;
          switch (panel.viewColumn) {
            case vscode.ViewColumn.One:
              updateWebviewForCat(panel, 'Coding Cat');
              return;

            case vscode.ViewColumn.Two:
              updateWebviewForCat(panel, 'Compiling Cat');
              return;

            case vscode.ViewColumn.Three:
              updateWebviewForCat(panel, 'Testing Cat');
              return;
          }
        },
        null,
        context.subscriptions
      );
    })
  );
}

function updateWebviewForCat(panel: vscode.WebviewPanel, catName: keyof typeof cats) {
  panel.title = catName;
  panel.webview.html = getWebviewContent(cats[catName]);
}
</code></pre>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-ondidchangeviewstate.gif" alt="å“åº”onDidChangeViewStateäº‹ä»¶" /></p>
<h3 id="æ£€æŸ¥å’Œè°ƒè¯•webviews"><a class="header" href="#æ£€æŸ¥å’Œè°ƒè¯•webviews">æ£€æŸ¥å’Œè°ƒè¯•webviews</a></h3>
<p>åœ¨å‘½ä»¤é¢æ¿ä¸­è¾“å…¥<strong>Developer: Toggle Developer Tools</strong>èƒ½å¸®åŠ©ä½ è°ƒè¯•webviewã€‚è¿è¡Œå‘½ä»¤ä¹‹åä¼šä¸ºå½“å‰å¯è§çš„webviewåŠ è½½ä¸€ä¸ªdevtoolï¼š</p>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/basics-developer_tools.png" alt="Webviewå¼€å‘è€…å·¥å…·" /></p>
<p>webviewçš„å†…å®¹æ˜¯åœ¨webviewæ–‡æ¡£ä¸­çš„ä¸€ä¸ªiframeä¸­çš„ï¼Œç”¨å¼€å‘è€…å·¥å…·æ£€æŸ¥å’Œä¿®æ”¹webviewçš„DOMï¼Œåœ¨webviewå†…è°ƒè¯•è„šæœ¬ã€‚</p>
<p>å¦‚æœä½ ç”¨äº†webviewå¼€å‘è€…å·¥å…·çš„consoleï¼Œç¡®ä¿ä½ åœ¨Consoleé¢æ¿å·¦ä¸Šè§’çš„ä¸‹æ‹‰æ¡†é‡Œé€‰ä¸­äº†å½“å‰<strong>æ¿€æ´»çª—ä½“</strong>ç¯å¢ƒï¼š</p>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/debug-active-frame.png" alt="é€‰æ‹©æ¿€æ´»çª—ä½“" /></p>
<p><strong>æ¿€æ´»çª—ä½“</strong>ç¯å¢ƒæ˜¯webviewè„šæœ¬æ‰§è¡Œçš„åœ°æ–¹ã€‚</p>
<p>å¦å¤–ï¼Œ<strong>Developer: Reload Webview</strong>å‘½ä»¤ä¼šåˆ·æ–°æ‰€æœ‰å·²æ¿€æ´»çš„webviewã€‚å¦‚æœä½ éœ€è¦é‡ç½®ä¸€ä¸ªwebviewçš„çŠ¶æ€ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šéå¸¸æœ‰ç”¨ï¼Œæˆ–è€…ä½ æƒ³è¦è¯»å–ç¡¬ç›˜å†…å®¹çš„webviewæ›´æ–°ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h2 id="åŠ è½½æœ¬åœ°å†…å®¹"><a class="header" href="#åŠ è½½æœ¬åœ°å†…å®¹">åŠ è½½æœ¬åœ°å†…å®¹</a></h2>
<hr />
<p>webviewè¿è¡Œåœ¨ç‹¬ç«‹çš„ç¯å¢ƒä¸­ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥è®¿é—®æœ¬åœ°èµ„æºï¼Œè¿™æ˜¯å‡ºäºå®‰å…¨æ€§è€ƒè™‘çš„åšæ³•ã€‚è¿™ä¹Ÿæ„å‘³ç€è¦æƒ³ä»ä½ çš„æ’ä»¶ä¸­åŠ è½½å›¾ç‰‡ã€æ ·å¼ç­‰å…¶ä»–èµ„æºï¼Œæˆ–æ˜¯ä»ç”¨æˆ·å½“å‰çš„å·¥ä½œåŒºåŠ è½½ä»»ä½•å†…å®¹çš„è¯ï¼Œä½ å¿…é¡»ä½¿ç”¨webviewä¸­çš„<code>vscode-resource:</code>åè®®ã€‚</p>
<p><code>vscode-resource:</code>åè®®å°±åƒ<code>file:</code>åè®®ä¸€æ ·ï¼Œä¸è¿‡å®ƒåªå…è®¸è®¿é—®æœ¬åœ°æ–‡ä»¶ã€‚å’Œ<code>file:</code>ä¸€æ ·çš„æ˜¯ï¼Œ<code>vscode-resource:</code>åªèƒ½ä»ç»å¯¹è·¯å¾„ä¸­åŠ è½½èµ„æºã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦ä»æœ¬åœ°æŠŠå–µå–µä»¬çš„gifæ‰“åŒ…è¿›æ¥ï¼Œè€Œä¸æ˜¯ä»Giphyï¼ˆå›½å¤–å‡ºåçš„gifæ”¶é›†ç«™ï¼‰é‡ŒåŠ è½½è¿›æ¥ã€‚è¦æƒ³åšåˆ°è¿™ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆç»™æœ¬åœ°æ–‡ä»¶æ–°å»ºä¸€ä¸ªURIï¼Œç„¶åç”¨<code>vscode-resource:</code>åè®®æ›´æ–°è¿™äº›URIï¼š</p>
<pre><code class="language-typescript">import * as vscode from 'vscode';
import * as path from 'path';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      // è·å–ç£ç›˜ä¸Šçš„èµ„æºè·¯å¾„
      const onDiskPath = vscode.Uri.file(
        path.join(context.extensionPath, 'media', 'cat.gif')
      );

      // è·å–åœ¨webviewä¸­ä½¿ç”¨çš„ç‰¹æ®ŠURI
      const catGifSrc = onDiskPath.with({ scheme: 'vscode-resource' });

      panel.webview.html = getWebviewContent(catGifSrc);
    })
  );
}
</code></pre>
<p><code>catGifSrc</code>çš„å€¼æœ€åä¼šåƒè¿™æ ·ï¼š</p>
<pre><code class="language-bash">vscode-resource:/Users/toonces/projects/vscode-cat-coding/media/cat.gif
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>scode-resource:</code>åªèƒ½è®¿é—®ä¸‹åˆ—åœ°å€çš„èµ„æºï¼š</p>
<ul>
<li>ä½ çš„æ’ä»¶å®‰è£…çš„ç›®å½•</li>
<li>ç”¨æˆ·å½“å‰æ¿€æ´»çš„å·¥ä½œåŒº</li>
</ul>
<p>ä½ ä¹Ÿå¯ä»¥ç”¨data URIå°†èµ„æºç›´æ¥åµŒå¥—åˆ°webviewä¸­å»ã€‚</p>
<h3 id="æ§åˆ¶æœ¬åœ°èµ„æºè®¿é—®"><a class="header" href="#æ§åˆ¶æœ¬åœ°èµ„æºè®¿é—®">æ§åˆ¶æœ¬åœ°èµ„æºè®¿é—®</a></h3>
<p>ä½¿ç”¨<code>localResourceRoots</code>é€‰é¡¹ï¼Œwebviewå¯ä»¥æ§åˆ¶<code>vscode-resource:</code>åŠ è½½çš„çš„èµ„æºã€‚
<code>localResourceRoots</code>å®šä¹‰äº†å¯èƒ½è¢«åŠ è½½çš„æœ¬åœ°å†…å®¹çš„æ ¹URIã€‚</p>
<p>æˆ‘ä»¬ç”¨<code>localResourceRoots</code>å»çº¦æŸ<strong>Cat Coding</strong>webviewåªåŠ è½½æˆ‘ä»¬æ’ä»¶çš„<code>media</code>ç›®å½•ä¸‹çš„å†…å®¹ï¼š</p>
<pre><code class="language-typescript">import * as vscode from 'vscode';
import * as path from 'path';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {
          // åªå…è®¸webviewåŠ è½½æˆ‘ä»¬æ’ä»¶çš„`media`ç›®å½•ä¸‹çš„èµ„æº
          localResourceRoots: [vscode.Uri.file(path.join(context.extensionPath, 'media'))]
        }
      );

      const onDiskPath = vscode.Uri.file(
        path.join(context.extensionPath, 'media', 'cat.gif')
      );
      const catGifSrc = onDiskPath.with({ scheme: 'vscode-resource' });

      panel.webview.html = getWebviewContent(catGifSrc);
    })
  );
}
</code></pre>
<p>ä¸ºäº†ç¦æ­¢æ‰€æœ‰çš„æœ¬åœ°èµ„æºï¼Œåªè¦æŠŠ<code>localResourceRoots</code>è®¾ä¸º<code>[]</code>å°±å¥½äº†ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œwebviewåº”è¯¥å’ŒåŠ è½½æœ¬åœ°èµ„æºä¸€æ ·ä¸¥æ ¼ï¼Œç„¶è€Œï¼Œ<code>vscode-resource</code>å’Œ<code>localResourceRoots</code>å¹¶ä¸ä¿è¯ç™¾åˆ†ç™¾çš„å®‰å…¨æ€§ã€‚è¯·ç¡®ä¿ä½ çš„webviewéµå¾ª<a href="/extension-guides/webview#%E5%AE%89%E5%85%A8%E6%80%A7">å®‰å…¨æ€§æœ€ä½³å®è·µ</a>ï¼Œå¼ºçƒˆå»ºè®®è€ƒè™‘æ·»åŠ ä¸€ä¸ª<a href="/extension-guides/webview#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5">å†…å®¹å®‰å…¨æ”¿ç­–</a>ä»¥ä¾¿çº¦æŸä¹‹ååŠ è½½çš„å†…å®¹ã€‚</p>
<h3 id="ç»™webviewå†…å®¹åŠ ä¸Šä¸»é¢˜"><a class="header" href="#ç»™webviewå†…å®¹åŠ ä¸Šä¸»é¢˜">ç»™webviewå†…å®¹åŠ ä¸Šä¸»é¢˜</a></h3>
<p>webviewå¯ä»¥åŸºäºå½“å‰çš„VS Codeä¸»é¢˜å’ŒCSSæ”¹å˜è‡ªèº«çš„æ ·å¼ã€‚VS Codeå°†ä¸»é¢˜åˆ†æˆ3ä¸­ç±»åˆ«ï¼Œè€Œä¸”åœ¨<code>body</code>å…ƒç´ ä¸ŠåŠ ä¸Šäº†ç‰¹æ®Šç±»åä»¥è¡¨æ˜å½“å‰ä¸»é¢˜ï¼š</p>
<ul>
<li><code>vscode-light</code>â€”â€”äº®è‰²ä¸»é¢˜</li>
<li><code>vscode-dark</code>â€”â€”æš—è‰²ä¸»é¢˜</li>
<li><code>vscode-high-contrast</code>â€”â€”é«˜åå·®ä¸»é¢˜</li>
</ul>
<p>ä¸‹åˆ—CSSæ”¹å˜äº†åŸºäºç”¨æˆ·å½“å‰ä¸»é¢˜çš„webviewå­—ä½“é¢œè‰²ï¼š</p>
<pre><code class="language-css">body.vscode-light {
  color: black;
}

body.vscode-dark {
  color: white;
}

body.vscode-high-contrast {
  color: red;
}
</code></pre>
<p>å½“å¼€å‘ä¸€ä¸ªwebviewåº”ç”¨çš„æ—¶å€™ï¼Œè¯·ä¿è¯åº”ç”¨èƒ½åœ¨ä¸‰ç§ä¸»é¢˜ä¸‹éƒ½å¯ä»¥è¿ä½œï¼ŒåŠ¡å¿…åœ¨é«˜åå·®æ¨¡å¼ä¸‹æµ‹è¯•ä½ çš„webviewï¼Œä»¥ä¾¿æœ‰è§†è§‰éšœç¢çš„ç”¨æˆ·ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p>
<p>webviewå¯ä»¥é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_variables">CSS variables</a>è®¿é—®VS Codeä¸»é¢˜ï¼Œè¿™äº›å˜é‡ä»¥<code>vscode</code>ä¸ºå‰ç¼€ï¼Œå¹¶ä¸”ç”¨<code>-</code>æ›¿ä»£äº†<code>.</code>ï¼Œä¾‹å¦‚<code>editor.foreground</code>å˜æˆäº†<code>var(--vscode-editor-foreground)</code>ï¼š</p>
<pre><code class="language-css">code {
  color: var(--vscode-editor-foreground);
}
</code></pre>
<p>æ›´å¤šå¯ç”¨çš„ä¸»é¢˜å˜é‡ï¼Œå‚é˜…<a href="/references/theme-color">ä¸»é¢˜è‰²å½©</a>ã€‚</p>
<p>ä¸‹é¢ä¹Ÿå®šä¹‰äº†ä¸€äº›ä¸å­—ä½“æœ‰å…³çš„å˜é‡ï¼š</p>
<ul>
<li><code>-vscode-editor-font-family</code> - ç¼–è¾‘å™¨çš„æ–‡å­—ç±»å‹(è®¾ç½®ä¸­çš„<code>editor.fontFamily</code>é…ç½®é¡¹)</li>
<li><code>-vscode-editor-font-weight</code> - ç¼–è¾‘å™¨çš„æ–‡å­—ç²—ç»†(è®¾ç½®ä¸­çš„<code>editor.fontWeight</code>é…ç½®é¡¹)</li>
<li><code>-vscode-editor-font-size</code> - ç¼–è¾‘å™¨æ–‡å­—å¤§å°(è®¾ç½®ä¸­çš„<code>editor.fontSize</code>é…ç½®é¡¹)</li>
</ul>
<h2 id="è„šæœ¬å’Œä¿¡æ¯ä¼ é€’"><a class="header" href="#è„šæœ¬å’Œä¿¡æ¯ä¼ é€’">è„šæœ¬å’Œä¿¡æ¯ä¼ é€’</a></h2>
<hr />
<p>æ—¢ç„¶webviewå°±åƒiframeä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¹Ÿå¯ä»¥è¿è¡Œè„šæœ¬ï¼Œwebviewä¸­çš„Javascripté»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œä¸è¿‡æˆ‘ä»¬èƒ½ç”¨<code>enableScripts: true</code>æ‰“å¼€å®ƒã€‚</p>
<p>è®©æˆ‘ä»¬å†™ä¸€æ®µè„šæœ¬ï¼Œè¿½è¸ªæˆ‘ä»¬å®¶å–µæ˜Ÿäººå†™ä»£ç çš„è¡Œæ•°ã€‚è¿è¡Œä¸€ä¸ªåŸºç¡€è„šæœ¬éå¸¸çš„å®¹æ˜“ï¼Œä½†æ˜¯æ³¨æ„è¿™ä¸ªç¤ºä¾‹åªä½œæ¼”ç¤ºç”¨é€”ï¼Œåœ¨å®è·µä¸­ï¼Œä½ çš„webviewåº”è¯¥éµå¾ª<a href="#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5">å†…å®¹å®‰å…¨æ”¿ç­–</a>ï¼Œç¦æ­¢è¡Œå†…è„šæœ¬ã€‚</p>
<pre><code class="language-typescript">import * as path from 'path';
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
    context.subscriptions.push(vscode.commands.registerCommand('catCoding.start', () =&gt; {
        const panel = vscode.window.createWebviewPanel('catCoding', &quot;Cat Coding&quot;, vscode.ViewColumn.One, {
            // åœ¨webviewä¸­å¯ç”¨è„šæœ¬
            enableScripts: true
        });

        panel.webview.html = getWebviewContent();
    }));
}

function getWebviewContent() {
    return
        `
            &lt;!DOCTYPE html&gt;
            &lt;html lang=&quot;en&quot;&gt;
            &lt;head&gt;
                &lt;meta charset=&quot;UTF-8&quot;&gt;
                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
                &lt;title&gt;Cat Coding&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;img src=&quot;https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif&quot; width=&quot;300&quot; /&gt;
                &lt;h1 id=&quot;lines-of-code-counter&quot;&gt;0&lt;/h1&gt;

                &lt;script&gt;
                    const counter = document.getElementById('lines-of-code-counter');

                    let count = 0;
                    setInterval(() =&gt; {
                        counter.textContent = count++;
                    }, 100);
                &lt;/script&gt;
            &lt;/body&gt;
            &lt;/html&gt;
        `;
}
</code></pre>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/scripts-basic.gif" alt="åœ¨webviewä¸­è¿è¡Œè„šæœ¬" /></p>
<p>å“‡ï¼çœŸæ˜¯ä½é«˜äº§çš„å–µä¸»å­!</p>
<p>!&gt; webveiwçš„è„šæœ¬èƒ½åšåˆ°ä»»ä½•æ™®é€šç½‘é¡µè„šæœ¬èƒ½åšåˆ°çš„äº‹æƒ…ï¼Œä½†æ˜¯webviewè¿è¡Œåœ¨è‡ªå·±çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè„šæœ¬ä¸èƒ½è®¿é—®VS Code APIã€‚</p>
<h3 id="å°†æ’ä»¶çš„ä¿¡æ¯ä¼ é€’åˆ°webview"><a class="header" href="#å°†æ’ä»¶çš„ä¿¡æ¯ä¼ é€’åˆ°webview">å°†æ’ä»¶çš„ä¿¡æ¯ä¼ é€’åˆ°webview</a></h3>
<p>æ’ä»¶å¯ä»¥ç”¨<code>webview.postMessage()</code>å°†æ•°æ®å‘é€åˆ°å®ƒçš„webviewä¸­ã€‚è¿™ä¸ªæ–¹æ³•èƒ½å‘é€ä»»ä½•åºåˆ—åŒ–çš„JSONæ•°æ®åˆ°webviewä¸­ï¼Œåœ¨webviewä¸­åˆ™é€šè¿‡<code>message</code>äº‹ä»¶æ¥å—ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹è¿™ä¸ªå®ç°ï¼Œåœ¨Cat Codingä¸­æ–°å¢ä¸€ä¸ªå‘½ä»¤æ¥è¡¨ç¤ºæˆ‘ä»¬å®¶çš„å–µåœ¨é‡æ„ä»–çš„ä»£ç ï¼ˆæ‰€ä»¥ä¼šå‡å°‘ä»£ç æ€»è¡Œæ•°ï¼‰ã€‚æ–°å¢<code>catCoding.doRefactor</code>å‘½ä»¤ï¼Œåˆ©ç”¨<code>postMessage</code>æŠŠæŒ‡ç¤ºå‘é€åˆ°webviewä¸­ï¼Œwebviewä¸­çš„<code>window.addEventListener('message' event =&gt; { ... })</code>åˆ™ä¼šå¤„ç†è¿™äº›ä¿¡æ¯ï¼š</p>
<pre><code class="language-typescript">export function activate(context: vscode.ExtensionContext) {

    // ç°åœ¨åªæœ‰ä¸€åªå–µå–µç¨‹åºå‘˜äº†
    let currentPanel: vscode.WebviewPanel | undefined = undefined;

    context.subscriptions.push(vscode.commands.registerCommand('catCoding.start', () =&gt; {
        if (currentPanel) {
            currentPanel.reveal(vscode.ViewColumn.One);
        } else {
            currentPanel = vscode.window.createWebviewPanel('catCoding', &quot;Cat Coding&quot;, vscode.ViewColumn.One, {
                enableScripts: true
            });
            currentPanel.webview.html = getWebviewContent();
            currentPanel.onDidDispose(() =&gt; { currentPanel = undefined; }, undefined, context.subscriptions);
        }
    }));

    // æˆ‘ä»¬æ–°çš„å‘½ä»¤
    context.subscriptions.push(vscode.commands.registerCommand('catCoding.doRefactor', () =&gt; {
        if (!currentPanel) {
            return;
        }

        // æŠŠä¿¡æ¯å‘é€åˆ°webview
        // ä½ å¯ä»¥å‘é€ä»»ä½•åºåˆ—åŒ–çš„JSONæ•°æ®
        currentPanel.webview.postMessage({ command: 'refactor' });
    }));
}

function getWebviewContent() {
    return
        `
            &lt;!DOCTYPE html&gt;
            &lt;html lang=&quot;en&quot;&gt;
            &lt;head&gt;
                &lt;meta charset=&quot;UTF-8&quot;&gt;
                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
                &lt;title&gt;Cat Coding&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;img src=&quot;https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif&quot; width=&quot;300&quot; /&gt;
                &lt;h1 id=&quot;lines-of-code-counter&quot;&gt;0&lt;/h1&gt;

                &lt;script&gt;
                    const counter = document.getElementById('lines-of-code-counter');

                    let count = 0;
                    setInterval(() =&gt; {
                        counter.textContent = count++;
                    }, 100);

                    // Handle the message inside the webview
                    window.addEventListener('message', event =&gt; {

                        const message = event.data; // The JSON data our extension sent

                        switch (message.command) {
                            case 'refactor':
                                count = Math.ceil(count * 0.5);
                                counter.textContent = count;
                                break;
                        }
                    });
                &lt;/script&gt;
            &lt;/body&gt;
            &lt;/html&gt;
        `;
</code></pre>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/scripts-extension_to_webview.gif" alt="å‘webviewä¼ é€’ä¿¡æ¯" /></p>
<h3 id="å°†webviewçš„ä¿¡æ¯ä¼ é€’åˆ°æ’ä»¶ä¸­"><a class="header" href="#å°†webviewçš„ä¿¡æ¯ä¼ é€’åˆ°æ’ä»¶ä¸­">å°†webviewçš„ä¿¡æ¯ä¼ é€’åˆ°æ’ä»¶ä¸­</a></h3>
<p>webviewä¹Ÿå¯ä»¥æŠŠä¿¡æ¯ä¼ é€’å›å¯¹åº”çš„æ’ä»¶ä¸­ï¼Œç”¨VS Code API ä¸ºwebviewæä¾›çš„<code>postMessage</code>å‡½æ•°æˆ‘ä»¬å°±å¯ä»¥å®Œæˆè¿™ä¸ªç›®æ ‡ã€‚è°ƒç”¨webviewä¸­çš„<code>acquireVsCodeApi</code>è·å–VS Code APIå¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°åœ¨ä¸€ä¸ªä¼šè¯ä¸­åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä½ å¿…é¡»ä¿æŒä½è¿™ä¸ªæ–¹æ³•è¿”å›çš„VS Code APIå®ä¾‹ï¼Œç„¶åå†è½¬äº¤åˆ°éœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹çš„åœ°æ–¹ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬åœ¨<strong>Cat Coding</strong>æ·»åŠ ä¸€ä¸ªå¼¹å‡ºbugçš„è­¦ç¤ºæ¡†ï¼š</p>
<pre><code class="language-typescript">export function activate(context: vscode.ExtensionContext) {
    context.subscriptions.push(vscode.commands.registerCommand('catCoding.start', () =&gt; {
        const panel = vscode.window.createWebviewPanel('catCoding', &quot;Cat Coding&quot;, vscode.ViewColumn.One, {
            enableScripts: true
        });

        panel.webview.html = getWebviewContent();

        // å¤„ç†webviewä¸­çš„ä¿¡æ¯
        panel.webview.onDidReceiveMessage(message =&gt; {
            switch (message.command) {
                case 'alert':
                    vscode.window.showErrorMessage(message.text);
                    return;
            }
        }, undefined, context.subscriptions);
    }));
}

function getWebviewContent() {
    return
        `
            &lt;!DOCTYPE html&gt;
            &lt;html lang=&quot;en&quot;&gt;
            &lt;head&gt;
                &lt;meta charset=&quot;UTF-8&quot;&gt;
                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
                &lt;title&gt;Cat Coding&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;img src=&quot;https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif&quot; width=&quot;300&quot; /&gt;
                &lt;h1 id=&quot;lines-of-code-counter&quot;&gt;0&lt;/h1&gt;

                &lt;script&gt;
                    (function() {
                        const vscode = acquireVsCodeApi();
                        const counter = document.getElementById('lines-of-code-counter');

                        let count = 0;
                        setInterval(() =&gt; {
                            counter.textContent = count++;

                            // Alert the extension when our cat introduces a bug
                            if (Math.random() &lt; 0.001 * count) {
                                vscode.postMessage({
                                    command: 'alert',
                                    text: 'ğŸ›  on line ' + count
                                })
                            }
                        }, 100);
                    }())
                &lt;/script&gt;
            &lt;/body&gt;
            &lt;/html&gt;
        `;
}
</code></pre>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/scripts-webview_to_extension.gif" alt="ä»webviewå‘æ’ä»¶ä¼ é€’ä¿¡æ¯" /></p>
<p>å‡ºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œä½ å¿…é¡»ä¿è¯VS Code APIçš„ç§æœ‰æ€§ï¼Œä¹Ÿä¸ä¼šæ³„éœ²åˆ°å…¨å±€çŠ¶æ€ä¸­å»ã€‚</p>
<h2 id="å®‰å…¨æ€§"><a class="header" href="#å®‰å…¨æ€§">å®‰å…¨æ€§</a></h2>
<hr />
<p>æ¯ä¸€ä¸ªä½ åˆ›å»ºçš„webviewéƒ½å¿…é¡»éµå¾ªè¿™äº›åŸºç¡€çš„å®‰å…¨æ€§æœ€ä½³å®è·µã€‚</p>
<h3 id="é™åˆ¶èƒ½åŠ›"><a class="header" href="#é™åˆ¶èƒ½åŠ›">é™åˆ¶èƒ½åŠ›</a></h3>
<p>webviewåº”è¯¥ç•™æœ‰å®ƒæ‰€éœ€çš„æœ€å°åŠŸèƒ½é›†åˆå³å¯ã€‚ä¾‹å¦‚ï¼šå¦‚æœä½ çš„webviewä¸éœ€è¦è¿è¡Œè„šæœ¬ï¼Œå°±ä¸è¦è®¾ç½®<code>enableScripts: true</code>ã€‚å¦‚æœä½ çš„webviewä¸éœ€è¦åŠ è½½ç”¨æˆ·å·¥ä½œåŒºçš„èµ„æºï¼Œå°±æŠŠ<code>localResourceRoots</code>è®¾ç½®ä¸º<code>[vscode.Uri.file(extensionContext.extensionPath)]</code>æˆ–è€…<code>[]</code>ä»¥ä¾¿ç¦æ­¢è®¿é—®ä»»ä½•æœ¬åœ°èµ„æºã€‚</p>
<h3 id="å†…å®¹å®‰å…¨ç­–ç•¥"><a class="header" href="#å†…å®¹å®‰å…¨ç­–ç•¥">å†…å®¹å®‰å…¨ç­–ç•¥</a></h3>
<p><a href="https://developers.google.com/web/fundamentals/security/csp/">å†…å®¹å®‰å…¨ç­–ç•¥</a>å¯ä»¥è¿›ä¸€æ­¥é™åˆ¶webviewå¯ä»¥åŠ è½½å’Œæ‰§è¡Œçš„å†…å®¹ã€‚ä¾‹å¦‚ï¼šå†…å®¹å®‰å…¨ç­–ç•¥å¼ºåˆ¶å¯ä»¥è¿è¡Œåœ¨webviewä¸­çš„è„šæœ¬ç™½åå•ï¼Œæˆ–è€…å‘Šè¯‰webviewåªåŠ è½½å¸¦<code>https</code>åè®®çš„å›¾ç‰‡ã€‚</p>
<p>è¦æƒ³åŠ ä¸Šå†…å®¹å®‰å…¨ç­–ç•¥ï¼Œå°†<code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot;&gt;</code>æŒ‡ä»¤æ”¾åˆ°webviewçš„<code>&lt;head&gt;</code>ä¸­</p>
<pre><code class="language-typescript">function getWebviewContent() {
    return
        `
            &lt;!DOCTYPE html&gt;
            &lt;html lang=&quot;en&quot;&gt;
            &lt;head&gt;
                &lt;meta charset=&quot;UTF-8&quot;&gt;

                &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src 'none';&quot;&gt;

                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;

                &lt;title&gt;Cat Coding&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
                ...
            &lt;/body&gt;
            &lt;/html&gt;
        `;
}
</code></pre>
<p><code>default-src 'none';</code>ç­–ç•¥ç›´æ¥ç¦æ­¢äº†æ‰€æœ‰å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰æ’ä»¶éœ€è¦çš„æœ€å°‘å†…å®¹ä¿®æ”¹è¿™ä¸ªæŒ‡ä»¤ï¼Œå¦‚åªå…è®¸é€šè¿‡<code>https</code>åŠ è½½æœ¬åœ°è„šæœ¬ã€æ ·å¼å’Œå›¾ç‰‡ï¼š</p>
<pre><code class="language-html">&lt;meta
    http-equiv=&quot;Content-Security-Policy&quot;
    content=&quot;default-src 'none'; img-src vscode-resource: https:; script-src vscode-resource:; style-src vscode-resource:;&quot;
&gt;
</code></pre>
<p>ä¸Šè¿°ç­–ç•¥ä¹Ÿéšå¼åœ°ç¦ç”¨äº†å†…è”è„šæœ¬å’Œæ ·å¼ã€‚æŠŠå†…è”æ ·å¼å’Œè„šæœ¬æå–åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å®è·µï¼Œä¹Ÿä¸ä¼šä¸å†…å®¹å®‰å…¨ç­–ç•¥å†²çªã€‚</p>
<h3 id="åªé€šè¿‡httpsåŠ è½½å†…å®¹"><a class="header" href="#åªé€šè¿‡httpsåŠ è½½å†…å®¹">åªé€šè¿‡httpsåŠ è½½å†…å®¹</a></h3>
<p>å¦‚æœä½ çš„webviewå…è®¸åŠ è½½å¤–éƒ¨èµ„æºï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ åªå…è®¸é€šè¿‡<code>https</code>åŠ è½½è€Œä¸è¦ä½¿ç”¨httpï¼Œä¸Šé¢çš„ä¾‹å­å·²ç»ç”¨å†…å®¹å®‰å…¨ç­–ç•¥å±•ç¤ºäº†ä½¿ç”¨<code>https</code>çš„æ–¹å¼ã€‚</p>
<h3 id="å®¡æŸ¥ç”¨æˆ·è¾“å…¥"><a class="header" href="#å®¡æŸ¥ç”¨æˆ·è¾“å…¥">å®¡æŸ¥ç”¨æˆ·è¾“å…¥</a></h3>
<p>å°±åƒæ„å»ºæ™®é€šHTMLé¡µé¢ä¸€æ ·ï¼Œä½ ä¹ŸåŒæ ·éœ€è¦åœ¨webviewä¸­å®¡æŸ¥ç”¨æˆ·è¾“å…¥çš„å†…å®¹ã€‚
æ²¡æœ‰å®¡æŸ¥è¾“å…¥å†…å®¹å¯èƒ½ä¼šå¯¼è‡´å†…å®¹æ³¨å…¥ï¼Œä¹Ÿå°±æ„å‘³ç€å°†ç”¨æˆ·ç½®äºäº†å±é™©ä¹‹ä¸­ã€‚</p>
<p>å¯èƒ½éœ€è¦å®¡æŸ¥çš„å€¼ï¼š</p>
<ul>
<li>æ–‡ä»¶å†…å®¹</li>
<li>æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è·¯å¾„</li>
<li>ç”¨æˆ·å·¥ä½œåŒºè®¾ç½®</li>
</ul>
<p>å¯ä»¥è€ƒè™‘ç”¨ä¸€ä¸ªè¾…åŠ©åº“å»æ„å»ºHTMLæ¨¡æ¿ï¼Œæˆ–è€…ç¡®ä¿æ‰€æœ‰æ¥è‡ªç”¨æˆ·å·¥ä½œåŒºçš„å†…å®¹éƒ½é€šè¿‡äº†å®¡æŸ¥</p>
<p>åªä¾èµ–å®¡æŸ¥å†…å®¹çš„å®‰å…¨æ€§æ˜¯ä¸å¤Ÿçš„ï¼Œä½ ä¹Ÿè¦éµå¾ªå…¶ä»–<a href="#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5">å®‰å…¨æ€§çš„æœ€ä½³å®è·µ</a>ï¼Œå°½å¯èƒ½å‡å°‘æ½œåœ¨çš„å†…å®¹æ³¨å…¥ã€‚</p>
<h2 id="æŒä¹…æ€§"><a class="header" href="#æŒä¹…æ€§">æŒä¹…æ€§</a></h2>
<hr />
<p>åœ¨webviewçš„æ ‡å‡†<a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">ç”Ÿå‘½å‘¨æœŸ</a>ä¸­ï¼Œ<code>createWebviewPanel</code>è´Ÿè´£åˆ›å»ºå’Œé”€æ¯ï¼ˆç”¨æˆ·å…³é—­æˆ–è€…è°ƒç”¨<code>.dispose()</code>æ–¹æ³•ï¼‰webviewã€‚è€Œwebviewçš„å†…å®¹å†æ˜¯åœ¨webviewå¯è§æ—¶åˆ›å»ºçš„ï¼Œåœ¨webviewå¤„äºéæ¿€æ´»çŠ¶æ€æ—¶é”€æ¯ã€‚webviewå¤„äºéæ¿€æ´»æ ‡ç­¾ä¸­æ—¶ï¼Œä»»ä½•webviewä¸­çš„ä¿ç•™çš„çŠ¶æ€éƒ½ä¼šä¸¢å¤±ã€‚</p>
<p>æ‰€ä»¥æœ€å¥½å‡å°‘webviewä¸­çš„çŠ¶æ€ï¼Œå–è€Œä»£ä¹‹ç”¨<a href="#%E5%B0%86webview%E7%9A%84%E4%BF%A1%E6%81%AF%E4%BC%A0%E9%80%92%E5%88%B0%E6%8F%92%E4%BB%B6%E4%B8%AD">æ¶ˆæ¯ä¼ é€’</a>å‚¨å­˜çŠ¶æ€ã€‚</p>
<h3 id="getstateå’Œsetstate"><a class="header" href="#getstateå’Œsetstate">getStateå’ŒsetState</a></h3>
<p>è¿è¡Œåœ¨webviewä¸­çš„è„šæœ¬å¯ä»¥ä½¿ç”¨<code>getState</code>å’Œ<code>setState</code>æ–¹æ³•ä¿å­˜å’Œæ¢å¤JSONåºåˆ—åŒ–çš„çŠ¶æ€å¯¹è±¡ã€‚è¿™ä¸ªçŠ¶æ€å¯ä»¥ä¸€ç›´ä¿ç•™ï¼Œå³ä½¿webviewé¢æ¿å·²ç»è¢«éšè—ï¼Œåªæœ‰å½“å®ƒé”€æ¯æ—¶ï¼ŒçŠ¶æ€åˆ™ä¼šä¸€èµ·é”€æ¯ã€‚</p>
<pre><code class="language-typescript">// webviewä¸­çš„è„šæœ¬
const vscode = acquireVsCodeApi();

const counter = document.getElementById('lines-of-code-counter');

// æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢å¤çŠ¶æ€
const previousState = vscode.getState();
let count = previousState ? previousState.count : 0;
counter.textContent = count;

setInterval(() =&gt; {
    counter.textContent = count++;
    // æ›´æ–°å·²ç»ä¿å­˜çš„çŠ¶æ€
    vscode.setState({ count })
}, 100);
</code></pre>
<p><code>getState</code>å’Œ<code>setState</code>æ˜¯ç”¨æ¥ä¿å­˜çŠ¶æ€çš„æ¯”è¾ƒå¥½çš„åŠæ³•ï¼Œå› ä¸ºä»–ä»¬çš„æ€§èƒ½æ¶ˆè€—è¦è¿œä½äº<code>retainContextWhenHidden</code>ã€‚</p>
<h3 id="åºåˆ—åŒ–"><a class="header" href="#åºåˆ—åŒ–">åºåˆ—åŒ–</a></h3>
<p>ä½¿ç”¨<code>WebviewPanelSerializer</code>ä¹‹åï¼Œä½ çš„webviewå¯ä»¥åœ¨VS Codeå…³é—­åè‡ªåŠ¨æ¢å¤ã€‚åºåˆ—åŒ–æ„å»ºäº<code>getState</code>å’Œ<code>setState</code>ä¹‹ä¸Šï¼Œåªæœ‰ä½ çš„æ’ä»¶æ³¨å†Œäº†<code>WebviewPanelSerializer</code>ï¼Œè¿™ä¸ªåŠŸèƒ½æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<p>ç»™æ’ä»¶çš„<code>package.json</code>æ·»åŠ ä¸€ä¸ª<code>onWebviewPanel</code>æ¿€æ´»äº‹ä»¶ï¼Œç„¶åæˆ‘ä»¬çš„ä»£ç å–µå°±èƒ½åœ¨VS Codeé‡å¯åç»§ç»­å·¥ä½œäº†ï¼š</p>
<pre><code class="language-json">&quot;activationEvents&quot;: [
    ...,
    &quot;onWebviewPanel:catCoding&quot;
]
</code></pre>
<p>è¿™ä¸ªæ¿€æ´»äº‹ä»¶ç¡®ä¿æˆ‘ä»¬çš„æ’ä»¶ä¸è®ºVS Codeä½•æ—¶æ¢å¤<code>catCoding</code>webviewæ—¶éƒ½ä¼šå¯åŠ¨ã€‚</p>
<p>ç„¶ååœ¨æˆ‘ä»¬æ’ä»¶çš„<code>activate</code>æ–¹æ³•ä¸­è°ƒç”¨<code>registerWebviewPanelSerializer</code>æ³¨å†Œä¸€ä¸ªæ–°çš„<code>WebviewPanelSerializer</code>ï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£æ¢å¤webviewä¹‹å‰ä¿å­˜çš„å†…å®¹ã€‚å…¶ä¸­çš„stateå°±æ˜¯webviewç”¨<code>setState</code>è®¾ç½®çš„JSONæ ¼å¼çš„çŠ¶æ€ã€‚</p>
<pre><code class="language-typescript">export function activate(context: vscode.ExtensionContext) {
    // å¸¸è§è®¾ç½®...

    // ç¡®ä¿æˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªåºåˆ—åŒ–å™¨
    vscode.window.registerWebviewPanelSerializer('catCoding', new CatCodingSerializer());
}

class CatCodingSerializer implements vscode.WebviewPanelSerializer {
    async deserializeWebviewPanel(webviewPanel: vscode.WebviewPanel, state: any) {
        // `state`æ˜¯webviewå†…è°ƒç”¨`setState`ä¿ç•™ä½çš„
        console.log(`Got state: ${state}`);

        // æ¢å¤æˆ‘ä»¬çš„webviewå†…å®¹
        //
        // ç¡®ä¿æˆ‘ä»¬å°†`webviewPanel`ä¼ é€’åˆ°äº†è¿™é‡Œ
        // ç„¶åç”¨äº‹ä»¶ä¾¦å¬å™¨æ¢å¤æˆ‘ä»¬çš„å†…å®¹
        webviewPanel.webview.html = getWebviewContent();
    }
}
</code></pre>
<p>åœ¨VS Codeä¸­æ‰“å¼€ä¸€ä¸ªå–µå–µæ‰“ä»£ç çš„é¢æ¿ï¼Œå…³é—­åé‡å¯å°±èƒ½çœ‹åˆ°è¿™ä¸ªé¢æ¿æ¢å¤åˆ°äº†ä¹‹å‰çš„çŠ¶æ€å’Œä½ç½®ã€‚</p>
<h3 id="éšè—æ—¶ä¿ç•™ä¸Šä¸‹æ–‡"><a class="header" href="#éšè—æ—¶ä¿ç•™ä¸Šä¸‹æ–‡">éšè—æ—¶ä¿ç•™ä¸Šä¸‹æ–‡</a></h3>
<p>å¦‚æœwebviewçš„è§†å›¾éå¸¸å¤æ‚ï¼Œæˆ–è€…çŠ¶æ€ä¸èƒ½å¾ˆå¿«åœ°ä¿å­˜å’Œæ¢å¤ï¼Œä½ åˆ™å¯ä»¥ç”¨<code>retainContextWhenHidden</code>é€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹åœ¨ä¸å¯è§çš„çŠ¶æ€ä¸­ä¿å­˜äº†webviewçš„å†…å®¹ï¼Œå³ä½¿webviewæœ¬èº«ä¸å¤„äºæ¿€æ´»çŠ¶æ€ã€‚</p>
<p>è™½ç„¶<strong>Cat Coding</strong>è¯´ä¸ä¸Šæœ‰å¾ˆå¤æ‚çš„çŠ¶æ€ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥æ‰“å¼€<code>retainContextWhenHidden</code>çœ‹çœ‹webviewçš„è¡Œä¸ºä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼š</p>
<pre><code class="language-typescript">import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () =&gt; {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {
          enableScripts: true,
          retainContextWhenHidden: true
        }
      );
      panel.webview.html = getWebviewContent();
    })
  );
}

function getWebviewContent() {
  return
    `
        &lt;!DOCTYPE html&gt;
        &lt;html lang=&quot;en&quot;&gt;
        &lt;head&gt;
            &lt;meta charset=&quot;UTF-8&quot;&gt;
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
            &lt;title&gt;Cat Coding&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;img src=&quot;https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif&quot; width=&quot;300&quot; /&gt;
            &lt;h1 id=&quot;lines-of-code-counter&quot;&gt;0&lt;/h1&gt;

            &lt;script&gt;
                const counter = document.getElementById('lines-of-code-counter');

                let count = 0;
                setInterval(() =&gt; {
                    counter.textContent = count++;
                }, 100);
            &lt;/script&gt;
        &lt;/body&gt;
        &lt;/html&gt;
    `;
}
</code></pre>
<p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/webview/persistence-retrain.gif" alt="æŒä¹…åŒ–ä¿ç•™" /></p>
<p>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°è®¡æ•°å™¨æ²¡æœ‰é‡ç½®ï¼Œwebviewéšè—ä¹‹åå°±æ¢å¤äº†ã€‚è€Œä¸”ä¸éœ€è¦å¤šä½™çš„ä»£ç ï¼<code>retainContextWhenHidden</code>çš„è¡Œä¸ºå°±åƒæµè§ˆå™¨ä¸€æ ·ï¼Œè„šæœ¬å’Œå…¶ä»–å†…å®¹è¢«æš‚æ—¶æŒ‚èµ·ï¼Œä½†æ˜¯ä¸€æ—¦webviewå¯è§ä¹‹åå°±ä¼šç«‹å³æ¢å¤ã€‚ä½†æ˜¯åœ¨webviewéšè—çŠ¶æ€ä¸‹ï¼Œä½ è¿˜æ˜¯ä¸èƒ½ç»™å®ƒå‘é€æ¶ˆæ¯çš„ã€‚</p>
<p>è™½ç„¶<code>retainContextWhenHidden</code>å¾ˆå¸å¼•äººï¼Œä½†æ˜¯è®°ä½è¿™ä¸ªåŠŸèƒ½çš„å†…å®¹å ç”¨å¾ˆé«˜ï¼Œåªæœ‰å…¶ä»–çš„æŒä¹…åŒ–æŠ€æœ¯æ— èƒ½ä¸ºåŠ›ä¹‹æ—¶å†é€‰æ‹©è¿™ç§æ–¹å¼ã€‚</p>
<h2 id="ä¸‹ä¸€æ­¥"><a class="header" href="#ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</a></h2>
<p>å¦‚æœä½ æƒ³äº†è§£å­¦ä¹ æ›´å¤šVS Codeæ‰©å±•æ€§çš„å†…å®¹ï¼Œè¯·æŸ¥çœ‹ä¸‹åˆ—ä¸»é¢˜ï¼š</p>
<ul>
<li><a href="/">æ’ä»¶API</a> - æ‰€æœ‰çš„VS Codeæ’ä»¶API</li>
<li><a href="/extension-capabilities/README">æ’ä»¶åŠŸèƒ½</a> - å…¶å®ƒæ‹“å±•VS CodeåŠŸèƒ½çš„æ–¹å¼</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../extension-guides/tree-view.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../extension-guides/notebook.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../extension-guides/tree-view.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../extension-guides/notebook.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
